<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="author" content="{{who_am_I}}" />
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<meta id="theme-color" name="theme-color" content="{{user-theme-color}}">

	<link rel="canonical" href="{{canonical}}">

	<title>{{pageTitle}}</title>
	<meta name="description" content="{{pageDescription}}">
	<style>
		/*csslint important:false*/
        .super-hearder {
            border: solid 1px rgb(223, 89, 11);
            padding: 2px;
            font-size: smaller;
            font-weight: 700;
            background-color: rgb(255, 254, 248);
            color: rgb(74, 83, 55);
        }
        .content-container {
            border: solid 1px rgb(0, 6, 85);
            padding: 2px;
            padding-left: 1px;
            background-color: rgb(230, 222, 210);
        }
        .super-container {
            width: calc(100% - 2px);
        }
        .owner_name {
            font-weight: bolder;
            color: rgb(30, 20, 95);
            font-style: normal;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 91%;
        }
        button {
            cursor: pointer;
            font-size: 85%;
            font-weight: bold;
            color:darkslateblue;
        }
        #content-frame {
            border: 1px solid rgba(245, 245, 245, 0.897);
        }
    </style>
</head>
<body>
<div class="super-hearder" >
    <span class="owner_name">{{who_am_I}}</span> :: control page :: 
    <button>security parameters</button>&nbsp;
    <button>local data</button>&nbsp;
    <button>idenity manager</button>
</div>
<div class="content-container" >
<iframe id="content-frame" src="" class="super-container" >
Source will open here
</iframe>
</div>
</body>
<script>
    window.addEventListener("message", (event) => {
        //
        let page_source = event.origin
        try {
            let data = JSON.parse(event.data)
            let source_code = data.relationship
            if ( source_code === 'of-this-world-opener' ) {
                let source = data.revise_source
                let frame = document.getElementById('content-frame')
                if ( frame ) {
                    frame.src = source
                }
            } else if ( source_code === 'of-this-world-standard-proxy' ) {
                let req_type = data.page_request
                switch ( req_type ) {
                    case "credentials" : {
                        tell_child("who_I_am")
                        break;
                    }
                    case "purchase" : {
                        break;
                    }
                    case "messages" : {
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }
        } catch (e) {
            alert("can't parse data from source")
        }
        // ...
    }, false);


    async function tell_child(what) {
        switch(what) {
            case "who_I_am" : {
                let frame = document.getElementById('content-frame')
                if ( frame && frame.contentWindow ) {
                    let message = {
                        "relationship" : 'human-of-this-world',
                        "page_request" : 'credentials',
                        "i_am" : "the guy in the braces"
                    }
                    let fw = frame.contentWindow
                    let message_str = JSON.stringify(message)
                    fw.postMessage(message_str)
                }
                break;
            }
            default : {
                break;
            }
        }
    }
</script>