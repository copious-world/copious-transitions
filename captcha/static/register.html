<div id="myRegisterModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h3><i>Captcha</i> : I am not a robot</h3>
        </div>
        <div class="modal-body">
            <div id="captcha-goes-here-register" style="border:1px solid lime;margin:2px;" >
                ------
            </div>
            <div id="captcha-entry-register" >
                Type in the text that you see above:
                <input type="text" id="captcha-field-register" class="svgFormTextField" style="font-size:14px;margin-top:1px;margin-left:2px;border:1px solid black;"/>
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="captchaCheck('register')">submit</button>
        </div>
    </div>
</div>

<div id="myRegisterForm" style="padding-left:10%;padding-top:8px;padding-bottom:8px" >
	<div id="register-errors_here" >no error</div>
	<div id="the-register-form-secure" style="color:darkorange;background-color: palegreen;visibility:hidden;display:none;">
        switching to a secure version of this page
    </div>


    <div class="form_el" >
        <label for='register-name' class='email'>Name:</span></label>
        <input type='email' name='register-name' id='register-name' value=''class='field_el name'  required onkeyup="onkey_checkRegisterError(this)"  />
    </div>
 
    <div class="form_el" >
        <label for='register-email' class='email'>Email:</span></label>
        <input type='email' name='register-email' id='register-email' value=''class='field_el email'  required onkeyup="onkey_checkRegisterError(this)"  />
    </div>
    
    <div class="form_el" >
        <label for='register-password' class='url'>Password:</span></label>
        <input type='password' name='register-password' id='register-password' value='' class='field_el password' onkeyup="onkey_checkRegisterError(this)"  />
    </div>
        
    <div class="form_el" >
        <label for='register-password-match' class='url'>Validate Password:</span></label>
        <input type='password' name='register-password-match' id='register-password-match' value='' class='field_el password' onkeyup="onkey_checkRegisterError(this)"  />
    </div>

    <p class='register-submit'>
    <button onclick="processRegister()" >Submit</button>
    </p>
</div>

<noscript><div id="noscript_warning">
	WARNING: You have JavaScript disabled in your web browser.  Many functions of this system will not work properly.
</div></noscript>

<script>

	// Get the modal
	
	function register_opening_view() {
		if (location.protocol !== 'https:') {           // start from a secure page
            let lformMSG = document.getElementById('the-register-form-secure')
            lformMSG.style.visibility = "visible"
            lformMSG.style.display = "block"
            setTimeout(()=> {location.replace(`https:${location.href.substring(location.protocol.length)}`)},1000)
        }
	}

    //
    function register_password_rules(fld_name,ptext) {
        return(true)
    }
	// REGISTRATION APPLICATION
	//
	var g_register_Handling = null
	function initRegistration() {
		g_register_Handling = new ValidationContainer({
				"auth_port" : "",
				"serice_url" : `http://${g_siteURL}/{{auth_path}}/users/register`,
				"errors_here" : document.getElementById('register-errors_here'),
				"failure_msg_prefix" : "Registration failed",
				"password_rules" : register_password_rules,
				"fields" : {
					"name" : document.getElementById('register-name'),
					"email" : document.getElementById('register-email'),
					"password" : document.getElementById('register-password'),
					"password-match" : document.getElementById('register-password-match'),
				},
				"checks" : {
					"is_empty" : ["password","email"],  // ref into fields above...
					"email" : ["email"],
					"passwords" : ["password","password-match"]
				},
				"modal" : document.getElementById("myRegisterModal"),
				"form" : document.getElementById('myRegisterForm'),
				"captcha" : document.getElementById('captcha-goes-here-register'),
				"captcha_field" : document.getElementById("captcha-field-register")
		});
	}

	function register_calcAppDataDB() {
		//
		let c_name =  g_register_Handling.fields["name"]
		let c_email =  g_register_Handling.fields["email"]
		let c_password = g_register_Handling.fields["password"]
		let c_password_verify = g_register_Handling.fields["password-match"]
		//
		let data = {
			"name" : getVal(c_name),
			"email" : getVal(c_email),
			"password" : getVal(c_password),
			"password-verify" : getVal(c_password_verify),
			'uuid' : g_currenCaptchaUUID
		}
		// register application
		data.name = data.name.length === 0 ? "anonymous" : data.name
		//
		return(data)
	}

	function registration_completionaAction() {
		show_thankyou_box()
	}

	function processRegister() {
		processUI_captchaService( g_register_Handling,
									register_calcAppDataDB,
									registration_completionaAction )
	}


	function onkey_checkRegisterError(focusEl) {
	   if ( g_register_Handling.checkFormValid() ) {
		   if ( focusEl ) focusEl.style.borderColor = 'black'
		   g_register_Handling.hideFormErrorMessage()
	   }
	}

	g_finalizers.push(initRegistration)
	
</script>

