<html>
	<head>
		<title>Register - Copious.World BB</title>
		<meta http-equiv="X-UA-Compatible" content="IE=8" >
		<meta name="keywords" content="groupware messaging collaboration" >
        <link href="http://www.copious.world/webcit-static/styles/webcit.css" rel="stylesheet" type="text/css">
	</head>
<body>

<div id="authbox_newuser" style="display: block" >
    <h2>New user?  Register now</h2>
    Enter the name and password you wish to use, and click &quot;New User.&quot; <br><br>
    <form id="ajax_newuser_form"  method="POST" action="signup" onsubmit="return checkForm()" >
        <label for="uname">User name:</label>
        <input type="text" name="name" id="uname" onKeyPress="newuser_onkeypress(event);">
        <br><br>
        <label for="upass">Password:</label>
        <input type="password" name="pass" id="upass" onKeyPress="newuser_onkeypress(event);">
        <br><br>
        <div style="text-align:justify;font-weight:530;color:brown;font-style: oblique;">
            We will send you an email with a link to the login page. -> When you receive the email, 
            your account should be active at that time.
        </div>
        <br>
        <label for="email">Email:</label>
        <input type="text" name="email" id="email" onKeyPress="newuser_onkeypress(event);">
        <br><br>
    </form>
    <button form="ajax_newuser_form" type="submit" class="logbuttons" style="color:orangered;font-size: x-large;"  >New User</button>
</div>

<div id="login_errmsg" style="color:red"> </div>

<noscript><div id="noscript_warning">
	WARNING: You have JavaScript disabled in your web browser.  Many functions of this system will not work properly.
</div></noscript>

<script>

    var reEmail = /^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
    //
    var g_msgTimeout = null
    function errorMessage(emsg) {
        let errDiv = document.querySelector('#login_errmsg')
        if ( errDiv ) {
            if ( g_msgTimeout ) {
                clearTimeout(g_msgTimeout)
            }
            errDiv.innerHTML = emsg
            g_msgTimeout = setTimeout(() => {
                let errDivNxt = document.querySelector('#login_errmsg')
                errDivNxt.innerHTML = ""
            },1500)
        }
    }
    //
    function checkEmailField(efield) {
		let email = efield.value
		if ( !(reEmail.test(email)) ) {
		  return(false)
		}
		return(true)
    }
    
    function checkForm() {
        let inspect_field = document.querySelector('#email')
        if ( !checkEmailField(inspect_field) ) {
            inspect_field.style.borderColor="red"
            errorMessage("unrecognized mail format")
            return(false)
        }
        inspect_field.style.borderColor="black"
        inspect_field = document.querySelector('#upass')
        let pass = inspect_field ? inspect_field.value : false
        if ( !pass || pass.length < 6 ) {
            inspect_field.style.borderColor="red"
            errorMessage("password is too short: 6 or more")
            return(false)
        }
        inspect_field.style.borderColor="black"
        inspect_field = document.querySelector('#uname')
        name = inspect_field ? inspect_field.value : false
        if ( !name || (name.length == 0) ) {
            inspect_field.style.borderColor="red"
            errorMessage("username is required")
            return(false)
        }
        inspect_field.style.borderColor="black"
        return(true)
    }


    function newuser_onkeypress(event) {
        checkForm()
    }

    //document.domain = "localhost:2006";
    var errStr = "$NOTHING"
    var g_error = `${errStr}`
    if ( errStr !==  "$NOTHING" ) {
        let errDiv = document.querySelector('#login_errmsg')
        if ( errDiv ) {
            errorMessage(g_error)
        }
    } 

</script>


</body>
</html>
